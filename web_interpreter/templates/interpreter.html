<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interpreter</title>
    <!-- ui-kit css -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.21.13/dist/css/uikit.min.css" />
    <!-- ui-kit js -->
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.21.13/dist/js/uikit.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.21.13/dist/js/uikit-icons.min.js"></script>
    <!-- cookie js -->
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script>
    <!-- <style>
        
    </style> -->
</head>
<body>
    <main class="uk-container uk-margin-top">
        <h1>Interpreter</h1>
        <div class="select_language">
            <select class="uk-select" name="language" id="language">
                <option value="python">python</option>
                <option value="cpp">c++</option>
            </select>
        </div>
        <div class="uk-container uk-padding-small">
            <textarea name="code" id="code" class="uk-textarea uk-height-medium"></textarea>
        </div>
        <div class="uk-container uk-flex uk-padding-small">
            <div class="uk-width-1-2 uk-margin-right">
                <label for="">input:</label>
                <textarea name="stdin" id="stdin" class="uk-textarea uk-height-small"></textarea>
            </div>
            <div class="uk-width-1-2 uk-margin-left">
                <label for="">output:</label>
                <textarea name="stdout" id="stdout" class="uk-textarea uk-height-small" readonly></textarea>
            </div>
        </div>
        <div class="uk-container uk-padding-small">
            <label for="">error:</label>
            <textarea name="stderr" id="stderr" class="uk-textarea uk-form-danger" readonly></textarea>
        </div>
        <div class="uk-container uk-padding-small uk-flex uk-flex-right">
            <button id="run" class="uk-button uk-button-primary">Запустить</button>
        </div>
    </main>

    <script>
        const csrftoken = Cookies.get('csrftoken');
        console.log(csrftoken)

        const button = document.getElementById('run')
        button.addEventListener('click', function (event) {

            button.disabled = true

            // Получаем данные из объектов с id language, code, input
            const language = document.getElementById('language').value;
            const code = document.getElementById('code').value;
            const stdin = document.getElementById('stdin').value;

            // Формируем объект для отправки на сервер
            const data = {
                language: language,
                code: code,
                input: stdin
            };

            // Отправляем данные на сервер с помощью fetch
            fetch('.', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken,
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                button.disabled = false
                console.log(result)
                // Помещаем полученные данные в объекты с id output и error
                document.getElementById('stdout').textContent = result.stdout;
                document.getElementById('stderr').textContent = result.stderr;
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('stderr').textContent = 'Ошибка при отправки или получении данных: ' + error;
            });
    });
    </script>
</body>
</html>